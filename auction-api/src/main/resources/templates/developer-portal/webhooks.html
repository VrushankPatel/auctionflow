<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Webhook Testing Tools - Auction Flow</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/developer-portal">Auction Flow Developer Portal</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/developer-portal/api-docs">API Documentation</a>
                <a class="nav-link" href="/developer-portal/rate-limits">Rate Limits</a>
                <a class="nav-link active" href="/developer-portal/webhooks">Webhooks</a>
                <a class="nav-link" href="/developer-portal/code-examples">Code Examples</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>Webhook Testing Tools</h1>
        <p class="lead">Simulate and test webhook events for your integrations.</p>

        <div class="card mt-4">
            <div class="card-header">
                Send Test Webhook
            </div>
            <div class="card-body">
                <form id="webhookForm">
                    <div class="mb-3">
                        <label for="webhookUrl" class="form-label">Webhook URL</label>
                        <input type="url" class="form-control" id="webhookUrl" placeholder="https://your-app.com/webhooks/auction" required>
                    </div>
                    <div class="mb-3">
                        <label for="eventType" class="form-label">Event Type</label>
                        <select class="form-select" id="eventType" required>
                            <option value="auction.created">auction.created</option>
                            <option value="auction.started">auction.started</option>
                            <option value="bid.placed">bid.placed</option>
                            <option value="auction.ended">auction.ended</option>
                            <option value="payment.succeeded">payment.succeeded</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="payload" class="form-label">Payload (JSON)</label>
                        <textarea class="form-control" id="payload" rows="10" placeholder='{"auctionId": "123", "amount": 100.00}'></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Send Webhook</button>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                Recent Webhook Attempts
            </div>
            <div class="card-body">
                <div id="webhookLogs" class="list-group">
                    <!-- Logs will be populated here -->
                </div>
            </div>
        </div>

        <div class="mt-4">
            <h3>Supported Webhook Events</h3>
            <ul class="list-group">
                <li class="list-group-item"><strong>auction.created</strong> - Fired when a new auction is created</li>
                <li class="list-group-item"><strong>auction.started</strong> - Fired when an auction begins</li>
                <li class="list-group-item"><strong>bid.placed</strong> - Fired when a bid is successfully placed</li>
                <li class="list-group-item"><strong>auction.ended</strong> - Fired when an auction closes</li>
                <li class="list-group-item"><strong>payment.succeeded</strong> - Fired when payment is processed</li>
            </ul>
        </div>
    </div>

    <script>
        document.getElementById('webhookForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const webhookUrl = document.getElementById('webhookUrl').value;
            const eventType = document.getElementById('eventType').value;
            const payload = document.getElementById('payload').value || '{}';

            fetch('/api/v1/webhooks/test', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    url: webhookUrl,
                    eventType: eventType,
                    payload: JSON.parse(payload)
                })
            })
            .then(response => response.json())
            .then(data => {
                addLogEntry(`Sent ${eventType} to ${webhookUrl}: ${data.status}`, 'success');
            })
            .catch(error => {
                addLogEntry(`Failed to send ${eventType}: ${error.message}`, 'danger');
            });
        });

        function addLogEntry(message, type) {
            const logs = document.getElementById('webhookLogs');
            const logEntry = document.createElement('div');
            logEntry.className = `list-group-item list-group-item-${type}`;
            logEntry.textContent = new Date().toLocaleString() + ': ' + message;
            logs.insertBefore(logEntry, logs.firstChild);

            // Keep only last 10 entries
            while (logs.children.length > 10) {
                logs.removeChild(logs.lastChild);
            }
        }

        // Pre-fill payload based on event type
        document.getElementById('eventType').addEventListener('change', function() {
            const eventType = this.value;
            const payloadField = document.getElementById('payload');
            let samplePayload = '{}';

            switch(eventType) {
                case 'auction.created':
                    samplePayload = '{"auctionId": "123e4567-e89b-12d3-a456-426614174000", "itemId": "item-123", "startTime": "2023-10-01T10:00:00Z", "endTime": "2023-10-01T12:00:00Z"}';
                    break;
                case 'bid.placed':
                    samplePayload = '{"auctionId": "123e4567-e89b-12d3-a456-426614174000", "bidderId": "user-456", "amount": 150.00, "timestamp": "2023-10-01T10:30:00Z"}';
                    break;
                case 'auction.ended':
                    samplePayload = '{"auctionId": "123e4567-e89b-12d3-a456-426614174000", "winnerId": "user-456", "finalPrice": 200.00}';
                    break;
            }

            payloadField.value = samplePayload;
        });

        // Trigger change to set initial payload
        document.getElementById('eventType').dispatchEvent(new Event('change'));
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>